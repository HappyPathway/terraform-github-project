# Plan: Add Documentation Source Clone Feature

## Overview
Add support for cloning external documentation repositories with specific tag/branch support. The terraform module will generate both the .projg configuration file and the projg script, with all values sourced from terraform variables.

## Move projg.tpl to projg, no longer needs to be template due to externalized config file

## Nuke should not remove documentation sources
since documentation sources will probably be shared across multiple projects, a nuke operation should not wipe out the documentation sources.


## Generated Configuration (.projg file)
The terraform module will generate this file using the variable values in a simple JSON format (which Terraform handles reliably):
```json
{
  "docs_base_path": "${docs_base_path}",
  "documentation_sources": ${jsonencode(documentation_sources)},
  "project_name": "${project_name}",
  "repo_org": "${repo_org}"
}
```

## Implementation Steps

1. **Terraform Module Updates**
   - Add new variables for documentation sources and base path
   - Create template for .projg configuration file using JSON format
   - Update projg script template to handle documentation sources
   - Add validation for variables

2. **Configuration File Generation**
   - Generate .projg file from terraform template
   - Place in repository root alongside projg script
   - Use terraform jsonencode function for proper JSON formatting
   - Add generated-by comment

3. **projg Script Updates**
   - Update projg script template to include config parsing
   - Add git operations for documentation sources
   - Handle environment variable expansion
   - Add error handling and logging

4. **Workspace File Integration**
   - Generate workspace file entries based on documentation sources
   - Use consistent path resolution between projg and workspace file

5. **Required Functions in projg Script**
```python
def load_projg_config() -> dict:
    """Load and validate .projg configuration file"""
    config_path = Path(".projg")
    if not config_path.exists():
        return default_config()
    return json.loads(config_path.read_text())

def clone_doc_source(repo: str, tag: str = "main") -> bool:
    """Clone repo and checkout specific tag"""
    try:
        subprocess.run(["git", "clone", "--no-checkout", repo])
        subprocess.run(["git", "checkout", tag])
        return True
    except subprocess.CalledProcessError:
        return False
```

## Testing Requirements
   - Test cases must include project_prompt, repo_org, and project_name
   - No Github Pro features should be used
   - Test terraform variable validation
   - Test .projg file generation
   - Test projg script documentation source handling
   - Test workspace file generation
   - Test with various variable combinations



## Considerations
- All configuration comes from terraform variables
- Both .projg config and projg script are generated by terraform
- Repositories are cloned as read-only documentation sources
- Use shallow cloning to minimize disk space and clone time
- Support tag/branch specification for version control
- No management or modification of these repos
- Clear labeling in workspace to indicate external reference status
- Handle .projg file not found gracefully
- Support updating to new tags when projg is run again
- Add logging for config loading and git operations
- Validate tags exist before attempting checkout
- Handle git operation failures gracefully